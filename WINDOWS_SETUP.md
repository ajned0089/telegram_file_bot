# دليل تثبيت بوت مشاركة الملفات على نظام Windows

هذا الدليل يشرح كيفية تثبيت وتشغيل بوت مشاركة الملفات على نظام Windows بدون استخدام Docker.

## المتطلبات الأساسية

- نظام Windows 10 أو 11
- Python 3.8 أو أحدث
- توكن بوت تيليجرام (من BotFather)
- قناة تخزين (قناة خاصة لتخزين الملفات)

## الخطوة 1: تثبيت Python

1. قم بتنزيل أحدث إصدار من Python (3.8 أو أحدث) من [الموقع الرسمي](https://www.python.org/downloads/windows/).
2. قم بتشغيل المثبت.
3. تأكد من تحديد خيار "Add Python to PATH" في أسفل نافذة المثبت.
   ![Add Python to PATH](https://docs.python.org/3/_images/win_installer.png)
4. انقر على "Install Now" واتبع التعليمات لإكمال التثبيت.
5. للتحقق من التثبيت، افتح موجه الأوامر (Command Prompt) واكتب:
   ```
   python --version
   ```
   يجب أن ترى رقم إصدار Python المثبت.

## الخطوة 2: تنزيل المشروع

1. قم بتنزيل المشروع من GitHub كملف ZIP أو استخدم Git إذا كان مثبتًا لديك:
   ```
   git clone https://github.com/yourusername/telegram_file_bot.git
   ```
2. إذا قمت بتنزيل الملف كـ ZIP، قم بفك ضغطه إلى مجلد على جهازك.

## الخطوة 3: إنشاء بيئة افتراضية

البيئة الافتراضية تساعد في عزل متطلبات المشروع عن بقية النظام.

1. افتح موجه الأوامر (Command Prompt) أو PowerShell.
2. انتقل إلى مجلد المشروع:
   ```
   cd C:\path\to\telegram_file_bot
   ```
   استبدل `C:\path\to\telegram_file_bot` بالمسار الفعلي لمجلد المشروع على جهازك.
3. قم بإنشاء بيئة افتراضية:
   ```
   python -m venv venv
   ```
4. قم بتنشيط البيئة الافتراضية:
   ```
   venv\Scripts\activate
   ```
   ستلاحظ أن بداية السطر في موجه الأوامر تغيرت لتشمل `(venv)` مما يشير إلى أن البيئة الافتراضية نشطة.

## الخطوة 4: تثبيت المتطلبات

1. مع تنشيط البيئة الافتراضية، قم بتثبيت المكتبات المطلوبة:
   ```
   pip install -r requirements.txt
   ```
   هذا سيقوم بتثبيت جميع المكتبات المطلوبة للمشروع.

## الخطوة 5: إعداد ملف الإعدادات

1. قم بنسخ ملف `.env.example` إلى `.env`:
   ```
   copy .env.example .env
   ```
2. قم بفتح ملف `.env` في محرر النصوص (مثل Notepad أو Visual Studio Code) وتعديل الإعدادات:
   ```
   # توكن البوت
   BOT_TOKEN=your_bot_token_here

   # معرفات المشرفين (مفصولة بفواصل)
   ADMIN_IDS=123456789

   # معرف قناة التخزين
   STORAGE_CHANNEL_ID=-100123456789

   # إعدادات قاعدة البيانات
   DATABASE_URL=sqlite:///app/database/bot_database.db

   # إعدادات لوحة الويب
   WEB_HOST=0.0.0.0
   WEB_PORT=8000
   WEB_ADMIN_USERNAME=admin
   WEB_ADMIN_PASSWORD=your_secure_password_here

   # إعدادات النسخ الاحتياطي
   BACKUP_DIR=backups
   BACKUP_INTERVAL=24  # ساعات
   ```
   استبدل القيم بالإعدادات الخاصة بك:
   - `BOT_TOKEN`: توكن البوت الخاص بك من BotFather
   - `ADMIN_IDS`: معرف تيليجرام الخاص بك (يمكنك الحصول عليه من @userinfobot)
   - `STORAGE_CHANNEL_ID`: معرف قناة التخزين (يجب أن يبدأ بـ -100)
   - `WEB_ADMIN_USERNAME` و `WEB_ADMIN_PASSWORD`: اسم المستخدم وكلمة المرور للوحة الإدارة

## الخطوة 6: إنشاء قناة تخزين

1. افتح تطبيق تيليجرام وقم بإنشاء قناة خاصة جديدة.
2. أضف البوت كمسؤول في القناة مع الصلاحيات الكاملة:
   - نشر الرسائل
   - تعديل الرسائل
   - حذف الرسائل
   - دعوة المستخدمين عبر الرابط
3. أرسل رسالة إلى القناة.
4. قم بإعادة توجيه هذه الرسالة إلى @username_to_id_bot للحصول على معرف القناة.
5. قم بتدوين معرف القناة (يجب أن يبدأ بـ -100 للقنوات الخاصة).
6. قم بتحديث متغير `STORAGE_CHANNEL_ID` في ملف `.env` بمعرف القناة.

## الخطوة 7: تهيئة قاعدة البيانات

1. مع تنشيط البيئة الافتراضية، قم بتشغيل سكريبت تهيئة قاعدة البيانات:
   ```
   python init_db.py
   ```
   هذا سيقوم بإنشاء قاعدة البيانات وإضافة الفئات والتنسيقات والإعدادات الأولية.

## الخطوة 8: تشغيل البوت

1. مع تنشيط البيئة الافتراضية، قم بتشغيل البوت:
   ```
   python run.py
   ```
   هذا سيقوم بتشغيل كل من البوت وخادم الويب.

2. لتشغيل البوت فقط:
   ```
   python run.py --bot-only
   ```

3. لتشغيل خادم الويب فقط:
   ```
   python run.py --web-only
   ```

## الخطوة 9: الوصول إلى لوحة الإدارة

1. افتح المتصفح وانتقل إلى:
   ```
   http://localhost:8000
   ```
   أو إذا كنت تصل من جهاز آخر على نفس الشبكة:
   ```
   http://your_computer_ip:8000
   ```
   حيث `your_computer_ip` هو عنوان IP لجهاز الكمبيوتر الخاص بك.

2. قم بتسجيل الدخول باستخدام اسم المستخدم وكلمة المرور التي حددتها في ملف `.env`.

## الخطوة 10: بدء استخدام البوت

1. افتح تيليجرام وابحث عن البوت الخاص بك.
2. أرسل الأمر `/start` لبدء استخدام البوت.
3. استخدم الأمر `/help` لرؤية الأوامر المتاحة.

## الخطوة 11: إعداد البوت للتشغيل التلقائي عند بدء تشغيل Windows

إذا كنت ترغب في تشغيل البوت تلقائيًا عند بدء تشغيل Windows:

1. قم بإنشاء ملف دفعي (batch file) باسم `start_bot.bat` في مجلد المشروع:
   ```
   @echo off
   cd /d %~dp0
   call venv\Scripts\activate
   python run.py
   ```

2. قم بإنشاء اختصار لهذا الملف:
   - انقر بزر الماوس الأيمن على الملف `start_bot.bat`.
   - اختر "إنشاء اختصار".

3. انقل الاختصار إلى مجلد بدء التشغيل:
   - اضغط على `Win + R` لفتح مربع حوار التشغيل.
   - اكتب `shell:startup` واضغط Enter.
   - انسخ أو انقل الاختصار الذي أنشأته إلى هذا المجلد.

الآن سيتم تشغيل البوت تلقائيًا في كل مرة تقوم فيها بتشغيل جهاز الكمبيوتر.

## استكشاف الأخطاء وإصلاحها

### البوت لا يستجيب

1. تأكد من أن توكن البوت صحيح في ملف `.env`.
2. تأكد من أن البوت يعمل (`python run.py`).
3. تحقق من ملف السجل `bot.log` بحثًا عن أي أخطاء.
4. أعد تشغيل البوت إذا لزم الأمر.

### الملفات لا يتم تحميلها

1. تأكد من أن البوت لديه الأذونات اللازمة في قناة التخزين.
2. تحقق من أن معرف قناة التخزين صحيح في ملف `.env`.
3. تحقق من أن المستخدم لديه إذن لتحميل الملفات.
4. تحقق من ملف السجل `bot.log` بحثًا عن أي أخطاء أثناء عملية التحميل.

### لوحة الإدارة لا تعمل

1. تأكد من أن المنفذ المحدد في ملف `.env` غير مستخدم من قبل تطبيق آخر.
2. تأكد من أن خادم الويب يعمل (`python run.py` أو `python run.py --web-only`).
3. حاول الوصول إلى اللوحة باستخدام متصفح مختلف.
4. تحقق من ملف السجل `bot.log` بحثًا عن أي أخطاء.

### مشاكل قاعدة البيانات

1. تأكد من وجود ملف قاعدة البيانات وعدم تلفه.
2. حاول تهيئة قاعدة البيانات مرة أخرى (`python init_db.py`).
3. استعد من نسخة احتياطية إذا كانت متوفرة.

## نصائح إضافية

### تحديث البوت

لتحديث البوت إلى أحدث إصدار:

1. قم بتنشيط البيئة الافتراضية:
   ```
   venv\Scripts\activate
   ```

2. قم بسحب أحدث التغييرات من GitHub (إذا كنت تستخدم Git):
   ```
   git pull
   ```

3. قم بتحديث المتطلبات:
   ```
   pip install -r requirements.txt
   ```

4. أعد تشغيل البوت:
   ```
   python run.py
   ```

### النسخ الاحتياطي اليدوي

لإنشاء نسخة احتياطية يدوية:

1. قم بتنشيط البيئة الافتراضية:
   ```
   venv\Scripts\activate
   ```

2. قم بتشغيل الأمر التالي:
   ```
   python -c "from app.utils.helpers import create_backup; print(create_backup('app/database/bot_database.db', 'backups'))"
   ```

### استعادة من نسخة احتياطية

لاستعادة قاعدة البيانات من نسخة احتياطية:

1. قم بتنشيط البيئة الافتراضية:
   ```
   venv\Scripts\activate
   ```

2. قم بتشغيل الأمر التالي:
   ```
   python -c "from app.utils.helpers import restore_backup; restore_backup('backups/your_backup_file.db', 'app/database/bot_database.db')"
   ```
   استبدل `your_backup_file.db` باسم ملف النسخة الاحتياطية الفعلي.

### تغيير إعدادات البوت

يمكنك تغيير إعدادات البوت من خلال:

1. تعديل ملف `.env` مباشرة.
2. استخدام لوحة الإدارة على الويب (الإعدادات > تعديل الإعدادات).

### مراقبة استخدام الموارد

إذا كان البوت يعمل على خادم Windows، فمن المفيد مراقبة استخدام الموارد:

1. افتح Task Manager بالضغط على `Ctrl + Shift + Esc`.
2. انتقل إلى تبويب "Processes" أو "Details".
3. ابحث عن عمليات `python.exe` المرتبطة بالبوت.
4. راقب استخدام وحدة المعالجة المركزية والذاكرة.