# دليل تثبيت بوت مشاركة الملفات على منصة Railway

هذا الدليل يشرح كيفية نشر بوت مشاركة الملفات على منصة Railway بالتفصيل.

## ما هي منصة Railway؟

Railway هي منصة استضافة سحابية حديثة تتيح لك نشر تطبيقاتك بسهولة وسرعة. تقدم Railway بيئة مناسبة لتشغيل تطبيقات Python والتطبيقات الأخرى مع دعم للقواعد البيانات وإدارة المتغيرات البيئية.

## المتطلبات الأساسية

- حساب على [Railway](https://railway.app/)
- حساب على [GitHub](https://github.com/)
- توكن بوت تيليجرام (من BotFather)
- قناة تخزين (قناة خاصة لتخزين الملفات)

## الخطوة 1: إعداد حساب Railway

1. قم بزيارة [موقع Railway](https://railway.app/) وانقر على "Login".
2. قم بتسجيل الدخول باستخدام حساب GitHub الخاص بك.
3. أكمل عملية التسجيل وتأكيد الحساب إذا طُلب منك ذلك.

## الخطوة 2: إعداد مستودع GitHub

1. قم بنسخ (fork) مستودع البوت إلى حساب GitHub الخاص بك أو قم بتحميل الكود إلى مستودع جديد.
2. تأكد من أن المستودع يحتوي على الملفات التالية:
   - `requirements.txt`: يحتوي على جميع المكتبات المطلوبة
   - `Procfile`: ملف يخبر Railway كيفية تشغيل التطبيق

3. إذا لم يكن ملف `Procfile` موجودًا، قم بإنشائه في المجلد الرئيسي للمشروع بالمحتوى التالي:
   ```
   web: python run.py --web-only
   worker: python run.py --bot-only
   ```

4. تأكد من أن ملف `requirements.txt` يحتوي على جميع المكتبات المطلوبة. يمكنك إنشاؤه باستخدام الأمر التالي (بعد تثبيت المكتبات محليًا):
   ```
   pip freeze > requirements.txt
   ```

## الخطوة 3: إنشاء مشروع جديد على Railway

1. بعد تسجيل الدخول إلى Railway، انتقل إلى لوحة التحكم.
2. انقر على زر "New Project" في الزاوية العلوية اليمنى.
3. اختر "Deploy from GitHub repo".
4. حدد المستودع الذي يحتوي على كود البوت.
5. انقر على "Deploy Now" وانتظر حتى يتم استيراد المشروع.

## الخطوة 4: إضافة قاعدة بيانات PostgreSQL

1. في لوحة تحكم مشروعك على Railway، انقر على زر "New" في الزاوية العلوية اليمنى.
2. اختر "Database".
3. اختر "PostgreSQL".
4. انتظر حتى يتم إنشاء قاعدة البيانات.

## الخطوة 5: إعداد متغيرات البيئة

1. في لوحة تحكم مشروعك على Railway، انقر على خدمة التطبيق (وليس قاعدة البيانات).
2. انتقل إلى تبويب "Variables".
3. أضف المتغيرات التالية:

   ```
   BOT_TOKEN=your_bot_token_here
   ADMIN_IDS=123456789
   STORAGE_CHANNEL_ID=-100123456789
   DATABASE_URL=${DATABASE_URL}
   WEB_HOST=0.0.0.0
   WEB_PORT=${PORT}
   WEB_ADMIN_USERNAME=admin
   WEB_ADMIN_PASSWORD=your_secure_password_here
   BACKUP_DIR=backups
   BACKUP_INTERVAL=24
   ```

   ملاحظات:
   - استبدل `your_bot_token_here` بتوكن البوت الخاص بك من BotFather.
   - استبدل `123456789` بمعرف تيليجرام الخاص بك.
   - استبدل `-100123456789` بمعرف قناة التخزين.
   - استبدل `your_secure_password_here` بكلمة مرور قوية للوحة الإدارة.
   - `${DATABASE_URL}` و `${PORT}` هي متغيرات تلقائية توفرها Railway، لا تغيرها.

## الخطوة 6: تهيئة قاعدة البيانات

1. في لوحة تحكم مشروعك على Railway، انقر على خدمة التطبيق.
2. انتقل إلى تبويب "Deployments".
3. انتظر حتى يكتمل النشر الأولي.
4. انقر على أحدث نشر.
5. انقر على زر "Shell" في الزاوية العلوية اليمنى.
6. في نافذة الطرفية التي تظهر، قم بتشغيل الأمر التالي:
   ```
   python init_db.py
   ```
7. انتظر حتى تكتمل عملية تهيئة قاعدة البيانات.

## الخطوة 7: التحقق من حالة البوت

1. في لوحة تحكم مشروعك على Railway، انقر على خدمة التطبيق.
2. انتقل إلى تبويب "Logs".
3. تحقق من السجلات للتأكد من أن البوت يعمل بشكل صحيح.
4. يجب أن ترى رسائل تشير إلى بدء تشغيل البوت وخادم الويب.

## الخطوة 8: الوصول إلى لوحة الإدارة

1. في لوحة تحكم مشروعك على Railway، انقر على خدمة التطبيق.
2. انتقل إلى تبويب "Settings".
3. في قسم "Domains"، ستجد عنوان URL للتطبيق.
4. انقر على هذا الرابط للوصول إلى لوحة الإدارة.
5. قم بتسجيل الدخول باستخدام اسم المستخدم وكلمة المرور التي حددتها في متغيرات البيئة.

## الخطوة 9: اختبار البوت

1. افتح تيليجرام وابحث عن البوت الخاص بك.
2. أرسل الأمر `/start` لبدء استخدام البوت.
3. تأكد من أن البوت يستجيب ويعمل بشكل صحيح.
4. اختبر وظائف البوت المختلفة مثل رفع الملفات والبحث.

## إعدادات متقدمة

### تكوين النطاق المخصص

إذا كنت ترغب في استخدام نطاق مخصص للوحة الإدارة:

1. في لوحة تحكم مشروعك على Railway، انقر على خدمة التطبيق.
2. انتقل إلى تبويب "Settings".
3. في قسم "Domains"، انقر على "Generate Domain" أو "Custom Domain".
4. اتبع التعليمات لإعداد النطاق المخصص.

### إعداد النسخ الاحتياطي التلقائي

البوت يدعم النسخ الاحتياطي التلقائي، ولكن على Railway، قد تحتاج إلى تكوين تخزين خارجي للنسخ الاحتياطية:

1. قم بإعداد حساب على خدمة تخزين سحابية مثل AWS S3 أو Google Cloud Storage.
2. أضف متغيرات البيئة اللازمة للاتصال بخدمة التخزين.
3. قم بتعديل كود النسخ الاحتياطي لحفظ النسخ في التخزين السحابي.

### مراقبة الأداء

Railway توفر أدوات لمراقبة أداء تطبيقك:

1. في لوحة تحكم مشروعك على Railway، انقر على خدمة التطبيق.
2. انتقل إلى تبويب "Metrics".
3. راقب استخدام وحدة المعالجة المركزية والذاكرة والشبكة.

## استكشاف الأخطاء وإصلاحها

### البوت لا يستجيب

1. تحقق من سجلات التطبيق في تبويب "Logs".
2. تأكد من أن توكن البوت صحيح في متغيرات البيئة.
3. تأكد من أن البوت لم يتم حظره من قبل تيليجرام.
4. أعد تشغيل التطبيق من خلال النقر على "Restart" في تبويب "Settings".

### خطأ في قاعدة البيانات

1. تحقق من سجلات التطبيق في تبويب "Logs".
2. تأكد من أن متغير `DATABASE_URL` تم تعيينه بشكل صحيح.
3. تأكد من أن قاعدة البيانات تعمل (تحقق من حالة خدمة قاعدة البيانات).
4. حاول تهيئة قاعدة البيانات مرة أخرى باستخدام `python init_db.py` في الطرفية.

### لوحة الإدارة لا تعمل

1. تحقق من سجلات التطبيق في تبويب "Logs".
2. تأكد من أن متغيرات `WEB_HOST` و `WEB_PORT` تم تعيينها بشكل صحيح.
3. تأكد من أن خادم الويب يعمل (يجب أن ترى رسائل بدء التشغيل في السجلات).
4. تحقق من عنوان URL في قسم "Domains" وتأكد من أنه صحيح.

## تحديث البوت

لتحديث البوت على Railway:

1. قم بتحديث الكود في مستودع GitHub الخاص بك.
2. Railway ستكتشف التغييرات تلقائيًا وتقوم بإعادة نشر التطبيق.
3. يمكنك أيضًا تشغيل إعادة النشر يدويًا من خلال النقر على "Redeploy" في تبويب "Deployments".

## نصائح لتحسين الأداء

1. **تحسين استخدام الذاكرة**: راقب استخدام الذاكرة وقم بتحسين الكود إذا لزم الأمر.
2. **تحسين استعلامات قاعدة البيانات**: تأكد من أن استعلامات قاعدة البيانات فعالة وتستخدم الفهارس المناسبة.
3. **التخزين المؤقت**: استخدم التخزين المؤقت لتقليل عدد الطلبات إلى قاعدة البيانات.
4. **ضبط عدد العمال**: يمكنك ضبط عدد العمال في Gunicorn لتحسين الأداء.

## الخاتمة

الآن لديك بوت مشاركة الملفات يعمل على منصة Railway. يمكنك الوصول إلى لوحة الإدارة من أي مكان واستخدام البوت على تيليجرام. تأكد من مراقبة أداء البوت وتحديثه بانتظام لضمان أفضل تجربة للمستخدمين.