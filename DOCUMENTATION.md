# دليل شامل لبوت مشاركة الملفات في تيليجرام

## مقدمة

بوت مشاركة الملفات هو بوت تيليجرام متكامل يتيح للمستخدمين رفع ومشاركة الملفات بسهولة مع الآخرين. يوفر البوت العديد من الميزات المتقدمة مثل تصنيف الملفات، حماية الملفات بكلمة مرور، دعم اللغات المتعددة، ولوحة تحكم للمشرفين.

## الميزات الرئيسية

1. **رفع ومشاركة الملفات**:
   - رفع ملفات بأنواع مختلفة (مستندات، صور، فيديو، صوت)
   - مشاركة الملفات عبر روابط فريدة
   - حماية الملفات بكلمة مرور (اختياري)
   - تشفير الملفات لزيادة الأمان

2. **تنظيم الملفات**:
   - تصنيف الملفات ضمن فئات وفئات فرعية
   - تحديد تنسيق الملف
   - إضافة علامات (tags) للملفات لتسهيل البحث
   - إضافة تعليقات وتقييمات للملفات

3. **البحث المتقدم**:
   - البحث بالاسم
   - البحث بالعلامات
   - البحث بالفئة
   - البحث بالتنسيق
   - البحث بالمحتوى (للملفات النصية)

4. **دعم اللغات المتعددة**:
   - اللغة الإنجليزية
   - اللغة العربية
   - إمكانية إضافة لغات أخرى بسهولة

5. **نظام الإحالة**:
   - رابط إحالة فريد لكل مستخدم
   - تتبع المستخدمين المُحالين
   - مكافآت للمستخدمين الذين يقومون بالإحالة

6. **نظام الإشعارات**:
   - إشعارات تنزيل الملفات
   - إشعارات التعليقات والتقييمات
   - إشعارات تحديثات البوت
   - إشعارات انتهاء صلاحية الملفات

7. **لوحة تحكم المشرف**:
   - إدارة المستخدمين
   - إدارة الفئات والتنسيقات
   - إدارة قنوات الاشتراك الإجباري
   - إحصائيات مفصلة ورسوم بيانية
   - نسخ احتياطي واستعادة
   - إرسال رسائل بث للمستخدمين

8. **واجهة ويب للإدارة**:
   - لوحة تحكم ويب متكاملة
   - إدارة جميع جوانب البوت من خلال متصفح الويب
   - تحليلات متقدمة ورسوم بيانية

9. **واجهة برمجة تطبيقات (API)**:
   - واجهة RESTful API
   - مصادقة مفتاح API
   - دعم تكامل مع تطبيقات خارجية

10. **أمان متقدم**:
    - تشفير الملفات
    - حماية بكلمة المرور
    - تسجيل النشاط والأحداث
    - تحكم دقيق في صلاحيات المستخدمين

## هيكل المشروع

```
telegram_file_bot/
├── app/
│   ├── api/
│   │   └── api.py               # واجهة برمجة التطبيقات
│   ├── database/
│   │   ├── db.py                # إعدادات قاعدة البيانات والوظائف المساعدة
│   │   └── models.py            # نماذج قاعدة البيانات
│   ├── handlers/
│   │   ├── __init__.py          # تسجيل جميع المعالجات
│   │   ├── admin_handlers.py    # معالجات لوحة المشرف
│   │   ├── callback_handlers.py # معالجات الاستجابة للأزرار
│   │   ├── file_handlers.py     # معالجات رفع وتنزيل الملفات
│   │   ├── search_handlers.py   # معالجات البحث
│   │   └── user_handlers.py     # معالجات المستخدم العامة
│   ├── localization/
│   │   └── strings.py           # ترجمات النصوص
│   ├── utils/
│   │   ├── analytics.py         # وظائف التحليلات والإحصائيات
│   │   ├── helpers.py           # وظائف مساعدة عامة
│   │   ├── notifications.py     # نظام الإشعارات
│   │   ├── security.py          # وظائف الأمان والتشفير
│   │   └── states.py            # حالات المحادثة
│   ├── web/
│   │   ├── app.py               # تطبيق الويب
│   │   ├── templates/           # قوالب HTML
│   │   └── static/              # ملفات CSS و JavaScript
│   └── bot.py                   # الملف الرئيسي للبوت
├── backups/                     # مجلد النسخ الاحتياطية
├── .env                         # ملف الإعدادات البيئية
├── .env.example                 # نموذج لملف الإعدادات
├── main.py                      # نقطة الدخول الرئيسية
├── run.py                       # سكريبت تشغيل البوت
├── init_db.py                   # سكريبت تهيئة قاعدة البيانات
├── install.py                   # سكريبت التثبيت
├── requirements.txt             # متطلبات البايثون
├── README.md                    # ملف القراءة
├── SETUP_GUIDE.md               # دليل الإعداد
├── DEPLOYMENT_GUIDE.md          # دليل النشر
├── CUSTOMIZATION_GUIDE.md       # دليل التخصيص
└── DOCUMENTATION.md             # هذا الدليل
```

## الوحدات الرئيسية

### 1. وحدة قاعدة البيانات (`app/database/`)

تتكون من:
- `db.py`: يحتوي على إعدادات الاتصال بقاعدة البيانات ووظائف مساعدة مثل:
  - `get_db()`: للحصول على جلسة قاعدة البيانات
  - `init_db()`: لتهيئة قاعدة البيانات
  - `hash_password()` و `verify_password()`: لتشفير والتحقق من كلمات المرور
  - `generate_share_code()`: لإنشاء رموز مشاركة فريدة للملفات
  - `get_setting()` و `update_setting()`: للتعامل مع إعدادات البوت

- `models.py`: يحتوي على نماذج قاعدة البيانات مثل:
  - `User`: نموذج المستخدم
  - `File`: نموذج الملف
  - `Category`: نموذج الفئة
  - `Format`: نموذج التنسيق
  - `Tag`: نموذج العلامة
  - `FileDownload`: نموذج تنزيل الملف
  - `FileComment`: نموذج تعليق الملف
  - `FileRating`: نموذج تقييم الملف
  - `SubscriptionChannel`: نموذج قناة الاشتراك
  - `Settings`: نموذج الإعدادات
  - `Backup`: نموذج النسخ الاحتياطي
  - `Notification`: نموذج الإشعار
  - `ApiLog`: نموذج سجل API

### 2. وحدة المعالجات (`app/handlers/`)

تتكون من:
- `__init__.py`: لتسجيل جميع المعالجات
- `user_handlers.py`: معالجات المستخدم العامة مثل:
  - `start_command()`: معالج أمر البدء
  - `help_command()`: معالج أمر المساعدة
  - `settings_command()`: معالج أمر الإعدادات
  - `language_command()`: معالج أمر تغيير اللغة
  - `my_referral_command()`: معالج أمر رابط الإحالة
  - `my_files_command()`: معالج أمر عرض الملفات

- `file_handlers.py`: معالجات الملفات مثل:
  - `handle_file_upload()`: معالج رفع الملفات
  - `upload_file_to_channel()`: معالج تحميل الملف إلى قناة التخزين
  - `download_file()`: معالج تنزيل الملفات

- `search_handlers.py`: معالجات البحث مثل:
  - `search_command()`: معالج أمر البحث
  - `handle_search_by_name()`: معالج البحث بالاسم
  - `handle_search_by_tag()`: معالج البحث بالعلامة

- `admin_handlers.py`: معالجات المشرف مثل:
  - `admin_command()`: معالج أمر لوحة المشرف
  - `user_management()`: معالج إدارة المستخدمين
  - `broadcast_command()`: معالج إرسال رسائل البث

- `callback_handlers.py`: معالجات الاستجابة للأزرار مثل:
  - `handle_main_menu()`: معالج القائمة الرئيسية
  - `handle_settings_menu()`: معالج قائمة الإعدادات
  - `handle_language_selection()`: معالج اختيار اللغة

### 3. وحدة الترجمة (`app/localization/`)

تتكون من:
- `strings.py`: يحتوي على ترجمات النصوص بلغات مختلفة:
  - `en_strings`: النصوص باللغة الإنجليزية
  - `ar_strings`: النصوص باللغة العربية
  - `get_string()`: دالة للحصول على النص المترجم

### 4. وحدة الأدوات المساعدة (`app/utils/`)

تتكون من:
- `helpers.py`: وظائف مساعدة عامة مثل:
  - `get_or_create_user()`: للحصول على المستخدم أو إنشائه
  - `get_user_language()`: للحصول على لغة المستخدم
  - `can_upload()`: للتحقق من إمكانية رفع الملفات
  - `get_file_size_str()`: لتحويل حجم الملف إلى صيغة مقروءة
  - `create_backup()` و `restore_backup()`: لإنشاء واستعادة النسخ الاحتياطية

- `states.py`: حالات المحادثة مثل:
  - `FileUploadStates`: حالات رفع الملفات
  - `FileDownloadStates`: حالات تنزيل الملفات
  - `SearchStates`: حالات البحث
  - `AdminStates`: حالات لوحة المشرف

- `analytics.py`: وظائف التحليلات والإحصائيات مثل:
  - `get_user_growth()`: للحصول على نمو المستخدمين
  - `get_file_uploads()`: للحصول على إحصائيات رفع الملفات
  - `get_file_downloads()`: للحصول على إحصائيات تنزيل الملفات
  - `get_popular_categories()`: للحصول على الفئات الأكثر شعبية
  - `get_dashboard_stats()`: للحصول على إحصائيات لوحة التحكم

- `notifications.py`: نظام الإشعارات مثل:
  - `send_notification_to_user()`: لإرسال إشعار لمستخدم
  - `send_file_download_notification()`: لإرسال إشعار تنزيل ملف
  - `send_system_notification()`: لإرسال إشعار نظام
  - `get_user_notifications()`: للحصول على إشعارات المستخدم

- `security.py`: وظائف الأمان والتشفير مثل:
  - `encrypt_file()` و `decrypt_file()`: لتشفير وفك تشفير الملفات
  - `generate_secure_token()`: لإنشاء رمز آمن
  - `generate_api_key()` و `validate_api_key()`: لإنشاء والتحقق من مفاتيح API

### 5. وحدة الويب (`app/web/`)

تتكون من:
- `app.py`: تطبيق الويب الذي يحتوي على:
  - مسارات لوحة التحكم
  - مصادقة المستخدم
  - عرض الإحصائيات والبيانات
  - إدارة المستخدمين والملفات والفئات

- `templates/`: قوالب HTML مثل:
  - `base.html`: القالب الأساسي
  - `index.html`: صفحة لوحة التحكم الرئيسية
  - `users.html`: صفحة إدارة المستخدمين
  - `files.html`: صفحة إدارة الملفات

- `static/`: ملفات CSS و JavaScript

### 6. وحدة API (`app/api/`)

تتكون من:
- `api.py`: واجهة برمجة التطبيقات التي تحتوي على:
  - مسارات API للمستخدمين والملفات والفئات
  - مصادقة مفتاح API
  - تسجيل طلبات API

### 7. ملف البوت الرئيسي (`app/bot.py`)

يحتوي على:
- تهيئة البوت والمرسل
- تسجيل المعالجات
- جدولة المهام مثل النسخ الاحتياطي
- وظائف بدء وإيقاف البوت

## ميزات متقدمة

### 1. نظام الإشعارات

يوفر البوت نظام إشعارات متكامل يمكنه:
- إرسال إشعارات للمستخدمين عند تنزيل ملفاتهم
- إرسال إشعارات للمشرفين عن أحداث النظام المهمة
- إرسال إشعارات للمستخدمين عن تحديثات البوت
- إرسال إشعارات عن انتهاء صلاحية الملفات

يمكن للمستخدمين عرض إشعاراتهم وتحديدها كمقروءة من خلال أمر `/notifications`.

### 2. نظام التحليلات المتقدم

يوفر البوت نظام تحليلات متقدم يعرض:
- رسوم بيانية لنمو المستخدمين
- رسوم بيانية لرفع وتنزيل الملفات
- خرائط حرارية لنشاط المستخدمين
- إحصائيات عن الفئات والتنسيقات الأكثر شعبية
- إحصائيات عن معدل الاحتفاظ بالمستخدمين

يمكن للمشرفين الوصول إلى هذه التحليلات من خلال لوحة التحكم على الويب.

### 3. نظام الأمان المتقدم

يوفر البوت نظام أمان متقدم يشمل:
- تشفير الملفات باستخدام خوارزميات تشفير قوية
- حماية الملفات بكلمات مرور
- تسجيل جميع الأنشطة والأحداث
- مصادقة مفتاح API للوصول إلى واجهة برمجة التطبيقات
- تحكم دقيق في صلاحيات المستخدمين

### 4. نظام تقييم وتعليق الملفات

يمكن للمستخدمين:
- تقييم الملفات بنجوم (1-5)
- إضافة تعليقات على الملفات
- الإبلاغ عن الملفات المخالفة
- عرض تقييمات وتعليقات الآخرين

### 5. واجهة برمجة تطبيقات (API)

يوفر البوت واجهة برمجة تطبيقات RESTful تتيح:
- الوصول إلى الملفات والمستخدمين والفئات
- رفع وتنزيل الملفات برمجيًا
- البحث في الملفات
- إدارة المستخدمين والإعدادات

يتم تأمين الوصول إلى API باستخدام مفاتيح API فريدة لكل مستخدم.

### 6. التكامل مع خدمات التخزين السحابي

يمكن تكوين البوت لاستخدام خدمات التخزين السحابي مثل:
- Google Drive
- Dropbox
- OneDrive
- Amazon S3

هذا يتيح تخزين الملفات بشكل أكثر كفاءة وتوفير مساحة على خادم تيليجرام.

### 7. نظام التخزين المؤقت (Caching)

يستخدم البوت نظام تخزين مؤقت لتحسين الأداء من خلال:
- تخزين نتائج الاستعلامات المتكررة
- تخزين الإعدادات والترجمات
- تخزين معلومات المستخدمين النشطين

هذا يقلل من الحمل على قاعدة البيانات ويحسن زمن الاستجابة.

## دليل استخدام البوت

### للمستخدمين العاديين

1. **بدء استخدام البوت**:
   - أرسل `/start` لبدء استخدام البوت
   - اختر اللغة المفضلة لديك
   - اشترك في القنوات المطلوبة إذا كان ذلك مطلوبًا

2. **رفع ملف**:
   - أرسل `/upload` أو انقر على زر "رفع ملف"
   - أرسل الملف الذي تريد رفعه
   - اختر الفئة والتنسيق المناسبين
   - أدخل المعلومات الإضافية مثل المصدر والعلامات
   - اختر ما إذا كنت تريد حماية الملف بكلمة مرور
   - سيتم إنشاء رابط مشاركة للملف

3. **البحث عن ملفات**:
   - أرسل `/search` أو انقر على زر "بحث"
   - اختر طريقة البحث (بالاسم، بالعلامة، بالفئة، بالتنسيق)
   - أدخل استعلام البحث أو اختر الفئة/التنسيق
   - استعرض نتائج البحث

4. **عرض ملفاتك**:
   - أرسل `/myfiles` أو انقر على زر "ملفاتي"
   - استعرض الملفات التي قمت برفعها
   - يمكنك حذف ملفاتك أو تعديل معلوماتها

5. **تغيير الإعدادات**:
   - أرسل `/settings` أو انقر على زر "الإعدادات"
   - يمكنك تغيير اللغة
   - يمكنك عرض رابط الإحالة الخاص بك

### للمشرفين

1. **الوصول إلى لوحة المشرف**:
   - أرسل `/admin` أو انقر على زر "لوحة المشرف"
   - استعرض الخيارات المتاحة

2. **إدارة المستخدمين**:
   - عرض قائمة المستخدمين
   - تعديل صلاحيات المستخدمين
   - حظر/إلغاء حظر المستخدمين

3. **إدارة الفئات والتنسيقات**:
   - إضافة/تعديل/حذف الفئات
   - إضافة/تعديل/حذف التنسيقات

4. **إدارة قنوات الاشتراك**:
   - إضافة/تعديل/حذف قنوات الاشتراك المطلوبة

5. **عرض الإحصائيات**:
   - عرض إحصائيات المستخدمين والملفات
   - عرض رسوم بيانية للاستخدام

6. **إدارة النسخ الاحتياطي**:
   - إنشاء نسخ احتياطية يدوية
   - استعادة من نسخة احتياطية

7. **إرسال رسائل بث**:
   - إرسال رسائل لجميع المستخدمين
   - إرسال رسائل للمستخدمين النشطين فقط

## الخاتمة

بوت مشاركة الملفات هو حل متكامل لمشاركة الملفات عبر تيليجرام بطريقة آمنة ومنظمة. يوفر البوت العديد من الميزات المتقدمة مثل تصنيف الملفات، حماية الملفات بكلمة مرور، دعم اللغات المتعددة، ولوحة تحكم للمشرفين.

يمكن تخصيص البوت وتوسيعه بسهولة ليناسب احتياجاتك الخاصة من خلال تعديل الكود المصدري أو استخدام واجهة برمجة التطبيقات.

للمزيد من المعلومات حول تثبيت البوت، راجع [دليل الإعداد](SETUP_GUIDE.md).

للمزيد من المعلومات حول نشر البوت، راجع [دليل النشر](DEPLOYMENT_GUIDE.md).

للمزيد من المعلومات حول تخصيص البوت، راجع [دليل التخصيص](CUSTOMIZATION_GUIDE.md).